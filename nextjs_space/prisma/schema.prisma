generator client {
    provider = "prisma-client-js"
    binaryTargets = ["native", "linux-musl-arm64-openssl-3.0.x"]
}

datasource db {
    provider = "postgresql"
    url      = env("DATABASE_URL")
}

model Lead {
    id                  String   @id @default(uuid())
    email               String   @unique
    name                String
    company             String?
    phone               String?
    confirmationToken   String?  @map("confirmation_token")
    confirmed           Boolean  @default(false)
    calculatorData      Json?    @map("calculator_data")
    source              String?  @default("ai-workforce-calculator")
    createdAt           DateTime @default(now()) @map("created_at")
    updatedAt           DateTime @updatedAt @map("updated_at")
    
    calculatorResponses CalculatorResponse[]
    
    @@index([email])
    @@index([confirmationToken])
    @@index([confirmed])
    @@index([createdAt(sort: Desc)])
    @@map("leads")
}

model CalculatorResponse {
    id                String   @id @default(uuid())
    calculatorType    String   @map("calculator_type")
    responses         Json
    recommendations   Json?
    projectedSavings  Json?    @map("projected_savings")
    timestamp         DateTime @default(now())
    leadId            String?  @map("lead_id")
    
    lead              Lead?    @relation(fields: [leadId], references: [id], onDelete: Cascade)
    
    @@index([calculatorType, timestamp(sort: Desc)])
    @@map("calculator_responses")
}

model ContactSubmission {
    id        String   @id @default(uuid())
    name      String
    email     String
    company   String?
    phone     String?
    subject   String?
    message   String
    status    String   @default("new")
    createdAt DateTime @default(now()) @map("created_at")
    
    @@index([createdAt(sort: Desc)])
    @@index([status])
    @@map("contact_submissions")
}

model AdminUser {
    id           String   @id @default(uuid())
    email        String   @unique
    passwordHash String   @map("password_hash")
    name         String
    role         String   @default("admin")
    createdAt    DateTime @default(now()) @map("created_at")
    lastLogin    DateTime? @map("last_login")
    
    @@index([email])
    @@map("admin_users")
}

model BlogApiKey {
    id          String   @id @default(uuid())
    keyName     String   @map("key_name")
    apiKey      String   @unique @map("api_key")
    isActive    Boolean  @default(true) @map("is_active")
    createdAt   DateTime @default(now()) @map("created_at")
    lastUsedAt  DateTime? @map("last_used_at")
    usageCount  Int      @default(0) @map("usage_count")
    
    @@index([apiKey])
    @@map("blog_api_keys")
}

model ConsultationBooking {
    id              String   @id @default(uuid())
    name            String
    email           String
    company         String?
    phone           String?
    serviceInterest String   @map("service_interest")
    message         String?
    preferredDate   String?  @map("preferred_date")
    preferredTime   String?  @map("preferred_time")
    status          String   @default("pending")
    googleEventId   String?  @map("google_event_id")
    tidycalBookingId String? @map("tidycal_booking_id")
    createdAt       DateTime @default(now()) @map("created_at")
    
    @@index([createdAt(sort: Desc)])
    @@index([status])
    @@map("consultation_bookings")
}
